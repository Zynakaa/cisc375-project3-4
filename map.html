<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8"/>
	<link rel="stylesheet" href="https://unpkg.com/leaflet@1.6.0/dist/leaflet.css"
		integrity="sha512-xwE/Az9zrjBIphAcBb3F6JVqxf46+CDLwfLMHloNu6KEQCAWi6HcDUbeOfBIptF7tcCzusKFjFw2yuvEpDL9wQ=="
		crossorigin=""/>
	<link rel="stylesheet" href="src/leaflet-search.css" />
    <link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">

    <script type="application/javascript" src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
	<script type="application/javascript" src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js"></script>

	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
	<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script>
	
	<script type="application/javascript" src="https://cdn.jsdelivr.net/npm/vue"></script>
	<script src="https://unpkg.com/leaflet@1.6.0/dist/leaflet.js"
		integrity="sha512-gZwIG9x3wUXg2hdXF6+rVkLF/0Vi9U8D2Ntg4Ga5I5BZpVkVxlJWbSQtXPSiUTtC0TjtGOmxa1AJPuV0CPthew=="
		crossorigin=""></script>
	<script src="src/leaflet-search.js"></script>
	<script src="src/L.Control.MapCenterCoord.js"></script>
	
	<script type="application/javascript">
        function Prompt() {
            $("#dialog-form").dialog({
                autoOpen: true,
                modal: true,
                width: "360px",
                buttons: {
                    "Ok": function() {
                        var prompt_input = $("#prompt_input");
                        Init(prompt_input.val());
                        $(this).dialog("close");
                    },
                    "Cancel": function() {
                        $(this).dialog("close");
                    }
                }
            });
        }

        
    </script>

</head>
<body onload="Prompt()">

	<div id="dialog-form" style="z-index: 2">
        <label for="name">URL for St. Paul Crime API:</label>
        <input type="text" id="prompt_input" class="text ui-widget-content ui-corner-all" style="width: 320px;"/>
    </div>

	<div id="mapid" style="z-index: 1; position: absolute; top: 0; left: 0; bottom: 30%; right: 0"></div>
	
	
	<div id="app">
		<div class="scroll_table" style="z-index: 1; position: absolute; top: 70%; left: 0; bottom: 0; right: 0">
			<table class="table">
				<thead class="thead-dark">
					<tr>
						<th scope="col">Case Number</th>
						<th scope="col">Incident Type</th>
						<th scope="col">Incident</th>
						<th scope="col">Date/Time</th>
						<th scope="col">Police Grid</th>
						<th scope="col">Block</th>
						<th scope="col">Neighborhood Name</th>
					</tr>
				</thead>
				<tbody>
					<tr v-for="incident in incidents">
						<td scope="row">{{incident.case_number}}</td>
						<td>{{incident.code}}</td> <!--SWITCH TO INCIDENT TYPE-->
						<td>{{incident.incident}}</td>
						<td>{{incident.date_time}}</td>
						<td>{{incident.police_grid}}</td>
						<td>{{incident.block}}</td>
						<td>{{incident.neighborhood_number}}</td> <!--SWITCH TO NEIGHBORHOOD NAME-->
					</tr>
				</tbody>
			</table>
		</div>
	</div>
	
	<script>	
		app = new Vue({
			el: "#app",
			data: {
				incidents: {}
			}
		});
		
		function Init(crime_api_url)
		{
			//simulate an HTTP redirect
			$.get(crime_api_url + '/incidents?start_date=2019-10-1$end_date=2019-10-31', function(data)
			{
				app.incients = data;
				console.log(app.incidents);
			});
		}
		
		var myIcon = L.icon({
			iconUrl: 'images/icon.png',

			iconSize:     [50, 50], // size of the icon
			iconAnchor:   [22, 94], // point of the icon which will correspond to marker's location
			popupAnchor:  [-3, -76] // point from which the popup should open relative to the iconAnchor
		});
		
		var mymap = L.map('mapid').setView([44.9537, -93.0900], 13).setMaxBounds(L.latLngBounds(L.latLng(44.909424,-93.191443), L.latLng(45.008058, -92.997122)));
		
		L.tileLayer('https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token={accessToken}', {
			attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, <a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery Â© <a href="https://www.mapbox.com/">Mapbox</a>',			
			maxZoom: 18,
			minZoom: 13,
			id: 'mapbox/streets-v11',
			accessToken: 'pk.eyJ1Ijoia29jaDg2OTciLCJhIjoiY2szcnI5ZmhzMDk5ZTNtdWg2aGFneHA1aSJ9.uASUNV83v6H2Qr0QPfUkWw'
		}).addTo(mymap);
		
		mymap.addControl( new L.Control.Search({
			url: 'https://nominatim.openstreetmap.org/search?format=json&q={s}',
			jsonpParam: 'json_callback',
			propertyName: 'display_name',
			propertyLoc: ['lat','lon'],
			marker: L.marker([0,0],{icon: myIcon}).addTo(mymap),
			autoCollapse: true,
			autoType: false,
			minLength: 2
		}) );
		
		L.control.mapCenterCoord({
			onMove: true,
		}).addTo(mymap);
	</script>
</body>
</html>